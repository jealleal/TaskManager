# Task Manager Bot

<div align="center">
    
<img width="2048" height="807" alt="изображение" src="https://github.com/user-attachments/assets/f42e6fa9-82f3-4e65-b67c-94f43aa72ca4" />

</div>

## Содержание
- [Общее описание](#общее-описание)
- [Функциональность](#функциональность)
- [Архитектура базы данных](#архитектура-базы-данных)
- [Структура кода](#структура-кода)
- [Установка и запуск](#установка-и-запуск)
- [Ролевая модель](#ролевая-модель)
- [Команды и взаимодействие](#команды-и-взаимодействие)

## Общее описание

Telegram бот для управления задачами в команде с многоуровневой системой ролей. Система предоставляет инструменты для создания, назначения, отслеживания и завершения задач с поддержкой уведомлений, статистики и отчетности.

## Функциональность

### Основные возможности
- **Создание и управление задачами** с установкой сроков выполнения
- **Ролевая система** (администратор, руководитель, сотрудник)
- **Назначение исполнителей** и отслеживание прогресса
- **Система уведомлений** о новых задачах и изменениях статуса
- **Статистика и отчетность** по выполнению задач
- **Архивация** завершенных задач
- **Гибкая настройка прав доступа**

### Дополнительные функции
- Назначение руководителей сотрудникам
- Подтверждение выполнения задач руководителем
- Просмотр команд и подчиненных
- Логирование действий пользователей
- Приоритизация задач (высокий/средний/низкий)

## Архитектура базы данных

### Таблица `users`
Хранит информацию о пользователях системы.

| Поле | Тип | Описание |
|------|-----|----------|
| id | INTEGER PRIMARY KEY | Уникальный идентификатор пользователя (Telegram ID) |
| username | TEXT | Имя пользователя в Telegram |
| full_name | TEXT | Полное имя пользователя |
| role | TEXT DEFAULT 'rabotnik' | Роль в системе (admin/boss/rabotnik) |
| boss_id | INTEGER DEFAULT NULL | ID руководителя (для сотрудников) |
| created_at | TIMESTAMP DEFAULT CURRENT_TIMESTAMP | Дата регистрации |

### Таблица `tasks`
Содержит информацию о задачах.

| Поле | Тип | Описание |
|------|-----|----------|
| id | INTEGER PRIMARY KEY AUTOINCREMENT | Уникальный идентификатор задачи |
| title | TEXT | Название задачи |
| description | TEXT | Подробное описание задачи |
| assigned_to | INTEGER | ID исполнителя (ссылка на users.id) |
| created_by | INTEGER | ID создателя задачи (ссылка на users.id) |
| created_at | TIMESTAMP | Дата создания |
| deadline | TIMESTAMP | Срок выполнения |
| status | TEXT DEFAULT 'new' | Статус (new/in_progress/completed/archived) |
| priority | TEXT DEFAULT 'medium' | Приоритет (high/medium/low) |
| category | TEXT DEFAULT NULL | Категория задачи |

### Таблица `logs`
Логирование действий пользователей.

| Поле | Тип | Описание |
|------|-----|----------|
| id | INTEGER PRIMARY KEY AUTOINCREMENT | Уникальный идентификатор записи |
| user_id | INTEGER | ID пользователя |
| action | TEXT | Описание действия |
| timestamp | TIMESTAMP DEFAULT CURRENT_TIMESTAMP | Время действия |

### Таблица `notifications`
Хранение уведомлений для пользователей.

| Поле | Тип | Описание |
|------|-----|----------|
| id | INTEGER PRIMARY KEY AUTOINCREMENT | Уникальный идентификатор уведомления |
| user_id | INTEGER | ID получателя |
| task_id | INTEGER | ID связанной задачи |
| message | TEXT | Текст уведомления |
| is_read | BOOLEAN DEFAULT 0 | Флаг прочтения |
| created_at | TIMESTAMP DEFAULT CURRENT_TIMESTAMP | Дата создания |

## Структура кода

#### 1. Инициализация и настройка
```python
# Инициализация бота и диспетчера
bot = Bot(token=T, default=DefaultBotProperties(parse_mode="HTML"))
dp = Dispatcher(storage=MemoryStorage())

# Подключение базы данных
conn = sqlite3.connect('bazadannix.db', check_same_thread=False)
```

#### 2. Машина состояний (FSM)
```python
class FS(StatesGroup):
    T = State()      # Ввод названия задачи
    TD = State()     # Ввод описания задачи
    D = State()      # Установка срока
    A = State()      # Выбор исполнителя
    CN = State()     # Изменение имени
    P = State()      # Изменение фото
    CA = State()     # Изменение описания
    SC = State()     # Поиск контактов
    SET_ADMIN = State()   # Назначение администратора
    SET_BOSS = State()    # Назначение руководителя
    ASSIGN_BOSS = State() # Назначение подчинения
```

#### 3. Вспомогательные функции
- `gmk(uid)` - генерация клавиатуры в зависимости от роли
- `lga(uid, act)` - логирование действий
- `sn(uid, message, task_id)` - отправка уведомлений
- `menu(user_id)` - отображение главного меню

#### 4. Обработчики команд
- `/start` - регистрация и главное меню
- `/help` - справка по командам
- `/cancel` - отмена текущего действия

#### 5. Обработчики сообщений
- "Мои Задачи" - просмотр назначенных задач
- "Создать Задачу" - процесс создания новой задачи
- "Сотрудники" - просмотр списка пользователей (для админов/руководителей)
- "Управление Ролями" - изменение ролей пользователей
- "Уведомления" - просмотр непрочитанных уведомлений
- "Статистика" - просмотр статистики выполнения
- "Архив" - просмотр архивированных задач

#### 6. Обработчики callback-запросов
- Управление задачами (просмотр, взятие в работу, завершение)
- Управление ролями (назначение админа/руководителя)
- Управление уведомлениями (отметка как прочитанные)

## Установка и запуск

### Требования
- Python 3.8+
- aiogram 3.x
- sqlite3

### Установка зависимостей
```bash
pip install aiogram sqlite3
```

### Настройка бота
1. Получите токен бота у [@BotFather](https://t.me/BotFather)
2. Замените значение переменной `T` в коде на ваш токен от бота
3. Укажите ID администратора в переменной `B` (айди можно узнать через inline бота @dateregbot просто вписав юзернейм пользователя)

### Запуск
```bash
python bot.py
```

## Ролевая модель

### Администратор
- Полный доступ ко всем функциям системы
- Назначение ролей другим пользователям
- Просмотр всех задач и сотрудников
- Доступ к системной статистике
- Управление архивом задач

### Руководитель
- Создание задач для подчиненных
- Просмотр задач своей команды
- Подтверждение выполненных задач
- Просмотр отчетов по команде
- Назначение руководителей сотрудникам

### Сотрудник
- Просмотр назначенных задач
- Отметка выполнения задач
- Создание задач для себя
- Просмотр личной статистики
- Получение уведомлений о новых задачах

## Команды и взаимодействие

### Основное меню
Меню адаптируется под роль пользователя:
- **Администратор**: Полный набор функций управления
- **Руководитель**: Функции управления командой
- **Сотрудник**: Базовые функции работы с задачами

### Процесс создания задачи
1. Выбор "Создать Задачу"
2. Ввод названия задачи
3. Ввод описания задачи
4. Установка срока выполнения
5. Выбор исполнителя (для админов/руководителей)
6. Автоматическое уведомление исполнителя

### Управление задачами
- **Новая** → **В работе** → **Завершена** → **Архив**
- Приоритеты: Высокий, Средний, Низкий
- Автоматические уведомления при изменении статуса

### Особенности реализации
- Использование FSM для многошаговых процессов
- Inline-клавиатуры для интерактивного взаимодействия
- Логирование всех значимых действий
- Автоматическая очистка соединений с БД
- Обработка исключений и ошибок

---

<div align="center">

**Разработано на python и aiogram 3.x**

</div>
